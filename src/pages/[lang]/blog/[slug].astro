---
import type { GetStaticPaths } from "astro";
import { getCollection } from "astro:content";
import PostDetails from "@/layouts/PostDetails.astro";

export const getStaticPaths = (async () => {
  const posts = await getCollection("blog", ({ data }) => !data.draft);
  const locales = ["en", "zh-tw"] as const;
  return locales.flatMap((raw) => {
    const lang = raw as "en" | "zh-tw";
    return posts
      .filter((post) => post.data.lang === lang)
      .map((post) => {
        const slug = post.id.split("/").slice(-1)[0];
        return {
          params: { lang: raw, slug },
          props: { post, posts },
        };
      });
  });
}) satisfies GetStaticPaths;

const { post, posts } = Astro.props;
---

<PostDetails post={post} posts={posts} />